var cm=0,cy=0,state,rn=0,lwr=0,fwr=0,oss=0,events=[];$(document).ready(function(){function t(e){$("#views #container > div").remove(),0==state?(0>e&&(cm--,0==cm&&(cm=12,cy--)),e>0&&(cm++,13==cm&&(cm=1,cy++)),a(cm,cy)):(0>e?(rn--,fwr>rn&&(cm--,0==cm&&(cm=12,cy--),a(cm,cy),$("#views #container > div").remove(),rn=lwr,6!=new Date(Date.UTC(cy,cm,0)).getDay()&&rn--)):e>0&&(rn++,rn>lwr&&(rn=1,cm++,13==cm&&(cm=1,cy++))),a(cm,cy),l(rn))}function a(e,t){$("#views .head").html(s(e-1)+" "+t),o();var a,n,i,l,d,p,u,g,v,h,w,y;for(i=0,d=new Date(Date.UTC(t,e-1,1)).getDay(),e-1==0?(v=12,g=t-1,p=new Date(Date.UTC(g,v,0)).getDate()):(v=e-1,g=t,p=new Date(Date.UTC(g,v,0)).getDate()),fwr=0,0==d&&(d=7,fwr=1,i++),u=p-d+1,b=0;d-1>=b;b++)a="r0f"+b,$("#views #"+a).css("color","grey"),y=g+"-"+("0"+v).slice(-2)+"-"+("0"+u).slice(-2),$("#views #"+a).append("<div class='dates omonth'>"+u+"</div>"),$("#views #"+a).append("<div id='"+y+"' class='events pm 0e'></div>"),u++;l=new Date(Date.UTC(t,e,0)),u=l.getDate();for(var b=0;u-1>=b;b++)l.setDate(b+1),n=l.getDay(),a="r"+i+"f"+n,y=t+"-"+("0"+e).slice(-2)+"-"+("0"+(b+1)).slice(-2),$("#views #"+a).append("<div class='dates'>"+(b+1)+"</div>"),$("#views #"+a).append("<div id='"+y+"' class='events 0e'></div>"),lwr=i,6==n&&i++;for(u=1,12==e?(w=1,h=t+1):(w=e+1,h=t),6==n&&(n=-1),r=i;7>r;r++){for(f=n+1;7>f;f++)a="r"+r+"f"+f,$("#views #"+a).css("color","grey"),y=h+"-"+("0"+w).slice(-2)+"-"+("0"+u).slice(-2),$("#views #"+a).append("<div class='dates omonth'>"+u+"</div>"),$("#views #"+a).append("<div id='"+y+"' class='events nm 0e'></div>"),u++;n=-1}c()}function s(e){var t=["January","February","March","April","May","June","July","August","September","October","November","December"];return t[e]}function o(){for(r=0;6>r;r++)for(f=0;7>f;f++)$("#views #container").append(6==f?"<div id='new' class='lastcell cell '></div>":"<div id='new' class='cell'></div>"),$("#views #new").attr("id","r"+r+"f"+f)}function l(e){state=1;var t;for(r=0;6>r;r++)for(f=0;7>f;f++)t="r"+r+"f"+f,r!=e&&$("#views #"+t).remove();var a=$("#views #container div[id]").map(function(){return this.id}).get();for(a.sort(),$("#views .cell").addClass("week"),$("#views .lastcell").addClass("week"),$("#views .dates").addClass("w"),$("#views #container").prepend("<div id='timelinecontainer' class='cell time'style='font-size:0.3em'>Time</div>"),$("#views #container").append("<div id='timeline' class='cell time'></div>"),i=0;24>i;i++){var n=("0"+i+":00").slice(-5);$("#views #timeline").append("<div class='time side'>"+n+"</div>")}for(i=0;7>i;i++)$("#views #"+a[i]).remove();for($("#views #timeline").append("<div id='eiwc'></div>"),i=0;7>i;i++)$("#views #eiwc").append("<div class='eventinweek' id='"+a[i]+"'></div>");$("#views #"+a[6]).addClass("lastday"),$("#views .dates").css("background-color","#04756f");var o=[];o[0]=s(parseInt(a[0].slice(5,7))-1),o[1]=parseInt(a[0].slice(8,10)),o[2]=a[0].slice(0,4),o[3]=s(parseInt(a[6].slice(5,7))-1),o[4]=parseInt(a[6].slice(8,10)),o[5]=a[6].slice(0,4),$("#views .head").html(o[0]+" "+o[1]+", "+o[2]+" - "+o[3]+" "+o[4]+", "+o[5])}function c(){if(0==state)for(i=0;i<events.length;i++)p(events[i].id,events[i].title,events[i].start,events[i].end,events[i].status,events[i].allday);else if(1==state)for(i=0;i<events.length;i++)p(events[i].id,events[i].title,events[i].start,events[i].end,events[i].status,events[i].allday,events[i].imageurl)}function p(e,t,a,n,i,s){var r=a.slice(0,10),l=(n.slice(0,10),a.slice(11,16)),c=n.slice(11,16),d=t,p=l+" - "+c;s&&(p="All Day"),$("#views #"+r).append("<div class='eventinmonth' id='event-"+e+"'><div>"+d+"</div><div>"+p+"</div></div>"),color=getEventTimeData(a),$("#views #event-"+e).css("background-color",color[1])}$("#views").prepend("<div class='overlay'><img src='img/loading.svg' style='width:10%;height:10%;'></img></div>"),$("#views #back").click(function(){t(-1)}),$("#views #forward").click(function(){t(1)}),$("#views #addperson").on("click",function(){addPerson()}),$("#views #weekview").click(function(){0==state&&($("#views #days").prepend("<div class='time' id='time' style='float:left'>&nbsp;</div>"),l(fwr),state=1)}),$("#views #monthview").click(function(){1==state&&($("#views #time").remove(),$("#views #container > div").remove(),state=0,a(cm,cy))}),$(document).keydown(function(e){37==e.keyCode?t(-1):39==e.keyCode?t(1):27==e.keyCode&&($("#views #time").remove(),$("#views #container > div").remove(),state=0,a(cm,cy))})});